PS C:\Users\user\IdeaProjects\fork\AP2\samples\js> npm run dev

> ap2-ts-sample@0.1.0 dev
> npx ts-node src/dev.ts

→ Merchant Agent listening on http://localhost:8001/a2a/merchant_agent
→ Credentials Provider Agent listening on http://localhost:8002/a2a/credentials_provider
→ Merchant Payment Processor Agent listening on http://localhost:8003/a2a/merchant_payment_processor_agent
[dotenv@17.2.3] injecting env (0) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }

+-----------------------------------------------------------------------------+
| ADK Web Server started                                                      |
|                                                                             |
| For local testing, access at http://DESKTOP-PJJEB54:8000.                   |
+-----------------------------------------------------------------------------+
[ADK INFO]: event:  {"invocationId":"e-b5bb9d10-072d-4717-bec8-0f2cef6a2d70","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"100  달러 미만의 커피포트를 구매해줘. "}]},"id":"PlpmclwT","longRunningToolIds":[],"timestamp":1763536280374}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-5cc91d72-12ae-4eb4-9554-9f4d8cb84c17","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"100  달러 미만의 커피포트를 구매해줘."}]},"id":"sqciISQz","longRunningToolIds":[],"timestamp":1763536287831}
[ADK INFO]: event:  {"invocationId":"e-b5bb9d10-072d-4717-bec8-0f2cef6a2d70","author":"ts_ap2_shopping_agent","id":"UENLuvD
f","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToolIds":[],"timestamp":1763536280376,"errorCode":"503","errorMessage":"The model is overloaded. Please try again later."}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-1979ff02-f157-45a9-b65e-fd5c5d78076b","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"추천 해줘. 싸고 좋은걸로"}]},"id":"iny17xD6","longRunningToolIds":[],"timestamp":1763536303646}
[ADK INFO]: event:  {"invocationId":"e-5cc91d72-12ae-4eb4-9554-9f4d8cb84c17","author":"ts_ap2_shopping_agent","id":"5QpGQ3z
p","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToo
lIds":[],"timestamp":1763536287832,"content":{"parts":[{"text":"어떤 커피포트를 원하시나요? 100달러 미만이라는 조건 외에 브
드나 특정 모델, 혹은 수량 등 알려주시면 찾아보고 결제를 도와드리겠습니다."}],"role":"model"},"usageMetadata":{"promptToke e
nCount":623,"candidatesTokenCount":41,"totalTokenCount":664,"promptTokensDetails":[{"modality":"TEXT","tokenCount":623}]},"finishReason":"STOP"}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-5b9f8ef4-2dc7-445c-8201-8cbe9f51a7d3","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"엔티 크한 디자인 위주로"}]},"id":"YjNtMCqG","longRunningToolIds":[],"timestamp":1763536313269}
[ADK INFO]: event:  {"invocationId":"e-1979ff02-f157-45a9-b65e-fd5c5d78076b","author":"ts_ap2_shopping_agent","id":"TTiWxUd
A","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToo
lIds":[],"timestamp":1763536303648,"content":{"parts":[{"text":"음, \"싸고 좋은\"이라는 것이 개인마다 기준이 다를 수 있어서
. 혹시 선호하는 브랜드가 있으신가요? 아니면 대략적인 가격대나 용량 등을 알려주시면 제가 몇 가지 모델을 추천해 드릴 수 있
을 것 같습니다."}],"role":"model"},"usageMetadata":{"promptTokenCount":676,"candidatesTokenCount":58,"totalTokenCount":734,"promptTokensDetails":[{"modality":"TEXT","tokenCount":676}]},"finishReason":"STOP"}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-225001df-989b-4d30-8728-8d4b4d6a693a","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"선호 하는 재질이나 브랜드는 없어"}]},"id":"VJpdkp8Y","longRunningToolIds":[],"timestamp":1763536329413}
[ADK INFO]: event:  {"invocationId":"e-5b9f8ef4-2dc7-445c-8201-8cbe9f51a7d3","author":"ts_ap2_shopping_agent","id":"diPne9j
9","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToo
lIds":[],"timestamp":1763536313270,"content":{"parts":[{"text":"엔티크한 디자인의 커피포트라면, 보통 레트로 스타일이나 빈티
 느낌의 제품들을 많이 찾으십니다. 혹시 특정 브랜드나 재질 (예: 구리, 스테인리스 스틸 등)을 선호하시나요? 가격대는 100달러러
미만으로 유지하면서 찾아보겠습니다."}],"role":"model"},"usageMetadata":{"promptTokenCount":744,"candidatesTokenCount":72,""totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":744}]},"finishReason":"STOP"}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-5e40ec5f-59cd-4f40-b98e-98b0b6fc634f","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"\"드 롱기 (De'Longhi) 아이코\"로 찾아줘"}]},"id":"Pd1CzaTz","longRunningToolIds":[],"timestamp":1763536348988}
[ADK INFO]: event:  {"invocationId":"e-225001df-989b-4d30-8728-8d4b4d6a693a","author":"ts_ap2_shopping_agent","id":"elHPIxS
p","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToo
lIds":[],"timestamp":1763536329414,"content":{"parts":[{"text":"알겠습니다. 100달러 미만의 엔티크한 디자인 커피포트를 추천
해 드릴게요.\n\n**스메그 (Smeg) 레트로 전기포트**는 어떠신가요? 디자인이 매우 엔티크하고 색상도 다양해서 주방 인테리어에 포
트를 주기 좋습니다. 다만, 새 제품은 100달러를 넘는 경우가 많아서 중고나 할인 제품을 찾아봐야 할 수도 있습니다.\n\n만약 조조
 더 저렴한 가격대를 원하시면 **드롱기 (De'Longhi) 아이코나 빈티지 전기포트**도 좋은 선택입니다. 스메그와 비슷한 레트로 디디
인에 다양한 색상이 있습니다.\n\n혹시 이 중에서 마음에 드는 브랜드가 있으신가요? 아니면 다른 디자인의 커피포트를 찾아봐 드드
까요?"}],"role":"model"},"usageMetadata":{"promptTokenCount":827,"candidatesTokenCount":180,"totalTokenCount":1007,"promp ptTokensDetails":[{"modality":"TEXT","tokenCount":827}]},"finishReason":"STOP"}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-ee3c1b42-fc5a-41ae-a182-eeaa2fe1813c","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"\"드 롱기 (De'Longhi) 아이코\"로 찾아줘"}]},"id":"hw5mnjDH","longRunningToolIds":[],"timestamp":1763536359491}
[ADK INFO]: event:  {"invocationId":"e-5e40ec5f-59cd-4f40-b98e-98b0b6fc634f","author":"ts_ap2_shopping_agent","id":"gggPg1v
6","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToolIds":[],"timestamp":1763536348988,"errorCode":"503","errorMessage":"The model is overloaded. Please try again later."}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-5e5e12ee-d9d8-43c7-ad2a-cce601bb5a4a","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"\"드 롱기 (De'Longhi) 아이코\"로 찾아줘"}]},"id":"7MQ0JQwn","longRunningToolIds":[],"timestamp":1763536365342}
[ADK INFO]: event:  {"invocationId":"e-ee3c1b42-fc5a-41ae-a182-eeaa2fe1813c","author":"ts_ap2_shopping_agent","id":"eeqpO7z
f","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToolIds":[],"timestamp":1763536359492,"errorCode":"503","errorMessage":"The model is overloaded. Please try again later."}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-200230f8-050b-44fc-a200-81b70c8efcce","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"상관 없어. 일단 가격안으로 찾아줘"}]},"id":"Q8lZ1Fp5","longRunningToolIds":[],"timestamp":1763536378314}
[ADK INFO]: event:  {"invocationId":"e-5e5e12ee-d9d8-43c7-ad2a-cce601bb5a4a","author":"ts_ap2_shopping_agent","id":"unTGGj8
W","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToo
lIds":[],"timestamp":1763536365343,"content":{"parts":[{"text":"\"드롱기 아이코나 빈티지 전기포트\"를 찾으시는군요! 혹시 어
 색상이나 특정 모델명을 선호하시나요? 가격은 100달러 미만으로 맞춰서 찾아보겠습니다."}],"role":"model"},"usageMetadata":{ {
"promptTokenCount":1059,"candidatesTokenCount":51,"totalTokenCount":1110,"cachedContentTokenCount":721,"promptTokensDetails
":[{"modality":"TEXT","tokenCount":1059}],"cacheTokensDetails":[{"modality":"TEXT","tokenCount":721}]},"finishReason":"STOP"}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[ADK INFO]: event:  {"invocationId":"e-5dfff621-b142-4a3c-ad82-94d8eff57839","author":"user","actions":{"stateDelta":{},"ar
tifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"content":{"role":"user","parts":[{"text":"좋아 구매 진행해줘."}]},"id":"EnQY4F0e","longRunningToolIds":[],"timestamp":1763536393087}
[ADK INFO]: event:  {"invocationId":"e-200230f8-050b-44fc-a200-81b70c8efcce","author":"ts_ap2_shopping_agent","id":"GEnaND6
h","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{},"requestedToolConfirmations":{}},"longRunningToo
lIds":[],"timestamp":1763536378315,"content":{"parts":[{"thoughtSignature":"CtwKAdHtim9ZFTvnk9xx39yfYERObUlWmyaYsu/+AIxReMT
68/Eua7riLUhbMyg6DJbEsXwT8n/Qc25HjnA826QlLS2xzsh6uO6NLmtedC7cXcdmQznFdWi2sDmyDtRIISJX68dmCzwNKOL4D1hQ/I9ZRaGZPo8MnzYtrwOs0J
swiMZViu6AxxckbPPP7q7rx7HvPKkepT9lz+TYksFTEFIxIDnIirC2NMrV41juUHhmpU6SU4xwX9o6nx6+yCnHKY+tK11duP4r34ffOjeg4QjYIAZI4E1LRve/7
yEyFtDapvFW3q53ejiqBFEVMQclODW8asqo3Lkov6235VUbAOSBxWX32aoDmjYePprE8Jd9zSrKvU0xHPbCRNdiU/tPJhsj3Opr9sJjfVw8ImIKHLNIos84cvtM
EeMtb5xHYgsL+cfjlGjyFTMYKUnanRSjZB8FIHNx0moEshOVnpoC6qKbt0Xwe0Oi53Ab8SIN1YAT9wK+Yzknl82QsOR966Yh0W+D74NpicYye9rNwDvT92UY7up
hgmkzps7mlKgwhLSBgGE5yh6qU14i5NAoJNUNwAIDtSyezv46H36svbdkRnRHRCc5ECUM+q2krTixaUV23PrEJeDCI1phpwIgfjKFfeqPmc2+ZDvxFG2Fpxw1qK
K75M13p3s7wm8VF47GtnSI5IBQiGwgK7UePRIQ63IhFUOWrhhN5G3IPjg6EtviZ949O0ZJvYQYMJjq4LxrWP6Uwk2bjGPz9GT/J9l0obNc3MIL8mGxsFVX6ww/L
T8ZiSwoqPzomCmk66W33H59bJaGtWqC8JWBDFjR2zqWITVCMP8ujGaaZLeBtDDf14ObCt0SG3cbW2RCdn9JpVKGxAk1ZUODYaou78Mng+EgrYarFHJIiRy09VBu
ocIpol9Xic7rERVhOxAK3Vou/MUwr44835PTuHxK5wyvo7PE46fnPGR01eKzaSYJqwIRWphfVQNlSPs/zsqsSklE2ZcdfQz3sKvjmgnZm+d3M7nkRW7GXSFaMSW
takYjJKWGNUpf6mS1ulpFYpzsfwHqUlXwgZXIY7Iu+JhswWQIrmnAub1+urdBRVVX9f8I8ZD+yPl4j1w+skq2BIUbSvX78V+PkrlCl5Z91UK+Yi1HH+xXR/tI38
L1UqlJh3MxpDi9rz7+c9OmgRzmAtfec+c0IyjLWZBH1CB8NF38Ny6is43DzzlJlr1a0JrL1LxWo8vkg3LkMKbYt2SQfUEi172ahyrPMt3iPehIuRUzSKl7Ji4t6
1CBTFQL4Cx1auOehv1O1yOYa1nNrd3CPe5nDd8we1depfHHpEw3ltsDmnoXLxkLSIysbbCeT0wYKg3PuOkbsDp6Sgka5LZaQPpKWEf44K7e/l9TUaYYF6EF5K0U
1204sWMYpn8u6rhKFUBqceDv1hdmjgR/yQ15zNiZmJABhKgtqdTM+xOlqkcdA/NoQW9K13eQE62+SgfygzWzT9M3bQiLginR7LxAyzw4mgsvoAEopedILkX62FP
r7dQ60vIbIu5Ufbi3juPOT9ViEPQVt51exdkVJ59zAj8U3BjKpiDjOVzk4lN01RsqGu4z49uJhA6mmxSawy8EpcVB+/w3j0qwolNMXG/3mEsiEi+cvu3tzU9os/
7TF5LpeB1MPTGr8i8QfB/VdRjL4h9fJFXNmBJzzNDuSvu0Hobf8JPUz1T/xAgi48LmLIBw5qvO7igbk6yHMeQor7ym1beLCqGkolwjY3D12Bi8PwdJyeydSQ722
nd0OQRw+W0UZB7g9ai73dfmJGa8e40XdTS6iZyu3FKlYPcX96Wk8awcsMheQ3TZVA==","text":"알겠습니다. 드롱기 아이코나 빈티지 전기포트 중
100달러 미만의 제품으로 찾아보니, 보통 **95달러** 정도에 판매되는 모델들이 있습니다.\n\n**드롱기 아이코나 빈티지 전기포트
(색상 임의)**를 95 USD에 구매 진행해도 괜찮으실까요? 확인해 주시면 결제를 도와드리겠습니다."}],"role":"model"},"usageMetada
ta":{"promptTokenCount":1123,"candidatesTokenCount":88,"totalTokenCount":1549,"cachedContentTokenCount":730,"promptTokensDe
tails":[{"modality":"TEXT","tokenCount":1123}],"cacheTokensDetails":[{"modality":"TEXT","tokenCount":730}],"thoughtsTokenCount":338},"finishReason":"STOP"}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
[TaskUpdater.complete] {
  "id": "agent-msg-1",
  "parts": [
    {
      "data_part": {
        "key": "payment_receipt",
        "data": {
          "payment_mandate_id": "mandate_1763536395229",
          "timestamp": "2025-11-19T07:13:15.242Z",
          "payment_id": "pay_1763536395242",
          "amount": {
            "currency": "USD",
            "value": 95
          },
          "payment_status": {
            "merchant_confirmation_id": "DEBUG-APPROVED",
            "psp_confirmation_id": "DEBUG-PSP-001"
          },
          "payment_method_details": {
            "processor": "demo-card-processor"
          }
        }
      }
    }
  ],
  "role": "agent"
}
[ADK INFO]: Sending out request, model: gemini-2.5-flash, backend: GEMINI_API, stream: false
← Merchant Agent on port 8001 stopped
← Credentials Provider Agent on port 8002 stopped
← Merchant Payment Processor Agent on port 8003 stopped
PS C:\Users\user\IdeaProjects\fork\AP2\samples\js>